<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Container Resource Limits</title>
</head>
<body>
  <h1>Set Container Limits</h1>

  <form method="post">
    <table border="1" cellpadding="5" cellspacing="0">
      <thead>
        <tr>
          <th>Select</th>
          <th>Container Name</th>
          <th>Image</th>
          <th>Current Limits</th>
          <th>Memory</th>
          <th>CPUs</th>
        </tr>
      </thead>
      <tbody>
        {% for cont in containers %}
          {% set name = cont.name %}
          <tr>
            <td>
              <!-- Checkbox value is container name -->
              <input type="checkbox" name="containers" value="{{ name }}"
                {% if name in limits %} checked {% endif %}>
            </td>
            <td>{{ name }}</td>
            <td>{{ cont.image.tags|join(', ') }}</td>
            <td>
              {# Show existing saved limits if any: #}
              {% if name in limits %}
                Memory={{ limits[name]["memory"] }}, CPUs={{ limits[name]["cpus"] }}
              {% else %}
                (no saved limit)
              {% endif %}
            </td>
            <td>
              <!-- Dropdown for memory options; name attribute includes the container name -->
              <select name="memory_{{ name }}">
                <option value="">--</option>
                {% for opt in memory_options %}
                  <option value="{{ opt }}"
                    {% if name in limits and limits[name]["memory"] == opt %} selected {% endif %}>
                    {{ opt }}
                  </option>
                {% endfor %}
              </select>
            </td>
            <td>
              <!-- Dropdown for CPU options -->
              <select name="cpus_{{ name }}">
                <option value="">--</option>
                {% for opt in cpu_options %}
                  <option value="{{ opt }}"
                    {% if name in limits and limits[name]["cpus"] == opt %} selected {% endif %}>
                    {{ opt }}
                  </option>
                {% endfor %}
              </select>
            </td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
    <button type="submit">Apply Selected Limits</button>
  </form>
</body>
</html>
